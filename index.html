<!DOCTYPE html>
<html>

<head>
  <title>Bingo</title>
  <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&subset=latin,latin-ext" rel="stylesheet">
  <style>
    body {
      text-align: center;
      margin: 30px 0;
      font-family: 'IBM Plex Sans', sans-serif;
    }

    .active {
      background-color: #ff00007d;
    }

    table td {
      border: #3333333b 1px solid;
      background-color: #acacac1f;
      width: 20vw;
      height: 15vh;
      vertical-align: middle;
      text-align: center;
    }
    @media print {
    #wordListInput,
    #generateButton,
    #copyButton,
    #shareableUrl {
        display: none;
    }
    body{
        margin: 0;
    }
    table{
        margin: 5mm auto;
    }
}
  </style>
</head>

<body>
  <h1>Custom Bingo</h1>

  <table id="grid">

  </table>
  When you get five in a line yell out "BINGO!"<br/>
  <textarea id="wordListInput" rows="5" cols="50"
    placeholder="Enter words, separated by commas or newlines"></textarea><br>
  <button id="generateButton">Generate Bingo</button>
  <p id="shareableUrl"></p>
  <button id="copyButton">Copy URL</button>
  <script>
    document.getElementById('generateButton').addEventListener('click', generateBingo);

    function generateBingo() {
      const wordListText = document.getElementById('wordListInput').value;
      const words = parseWordList(wordListText);

      if (words.length < 25) {
        alert("Please enter at least 25 words.");
        return;
      }

      generateBingoBoard(words);
      generateShortenedUrl(words);
    }

    function generateShortenedUrl(words) {
      const encodedWords = btoa(JSON.stringify(words)); // Base64 encode
      const baseUrl = window.location.href.split('?')[0];
      const shortenedUrl = `${baseUrl}?data=${encodedWords}`;

      document.getElementById('shareableUrl').textContent = shortenedUrl;
    }

    function parseWordList(text) {
      return text.split(/[\n,]+/).map(word => word.trim()).filter(word => word !== '');
    }

    function generateBingoBoard(words) {
      const grid = document.getElementById('grid');
      grid.innerHTML = ''; // Clear previous board

    // Shuffle the words using the Fisher-Yates shuffle algorithm
    const shuffledWords = shuffleArray(words);
      console.log(shuffledWords);
    // Take the first 25 words for the bingo board
    const boardWords = shuffledWords.slice(0, 25);
    console.log(boardWords);
      for (let i = 0; i < 5; i++) {
        const row = document.createElement('tr');
        grid.appendChild(row);
        for (let j = 0; j < 5; j++) {
          const cell = document.createElement('td');
          cell.textContent = boardWords[5*i + j];
          row.appendChild(cell);
          // Add event listener to toggle "active" class
          cell.addEventListener('click', function () {
            this.classList.toggle('active');
          });
        }
      }
    }

    // Handle URL parameters on page load
    window.onload = function () {
      const urlParams = new URLSearchParams(window.location.search);
      const encodedWords = urlParams.get('data');

      if (encodedWords) {
        try {
          const words = JSON.parse(atob(encodedWords)); // Base64 decode
          generateBingoBoard(words);
        } catch (error) {
          console.error("Invalid URL parameters:", error);
          alert("Invalid URL parameters.");
        }
      }
    };

    // Fisher-Yates shuffle algorithm
function shuffleArray(array) {
    const newArray = [...array]; // Create a copy to avoid modifying the original array
    for (let i = newArray.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [newArray[i], newArray[j]] = [newArray[j], newArray[i]]; // Swap elements
    }
    return newArray;
}

document.getElementById('copyButton').addEventListener('click', copyToClipboard);

function copyToClipboard() {
    const urlText = document.getElementById('shareableUrl').textContent;

    if (navigator.clipboard) {
        navigator.clipboard.writeText(urlText)
            .then(() => {
                alert("URL copied to clipboard!");
            })
            .catch(err => {
                console.error('Could not copy text: ', err);
                alert("Failed to copy URL.");
            });
    } else {
        // Fallback for older browsers (less reliable)
        const textArea = document.createElement("textarea");
        textArea.value = urlText;
        document.body.appendChild(textArea);
        textArea.select();
        try {
            document.execCommand('copy');
            alert("URL copied to clipboard!");
        } catch (err) {
            console.error('Could not copy text: ', err);
            alert("Failed to copy URL.");
        }
        document.body.removeChild(textArea);
    }
}
  </script>
</body>

</html>